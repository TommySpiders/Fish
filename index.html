<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fish Tank</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      overscroll-behavior: none;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      /* make background similar to tank water so any edges are not obvious */
      background: #015573;
      color: #fff;
    }

    /* Rotate hint in portrait */
    @media screen and (orientation: portrait) {
      body::before {
        content: "Rotate your device to play";
        position: fixed;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        background: #000;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        z-index: 9999;
      }
    }

    #gameRoot {
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    /* Tank fills whole screen */
    #tank {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #015573;
    }

    /* SINGLE background ‚Äì smooth animated */
    #tankBackground {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-image: url("background1.PNG");
      background-size: cover;           /* fill the tank */
      background-position: center 40%;  /* show more open water, less bottom */
      background-repeat: no-repeat;
      will-change: transform;
      pointer-events: none;
      z-index: 1;
    }

    #fxCanvas {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 2;       /* bubbles & water glow */
      pointer-events: none;
    }

    #fishLayer {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 3;       /* fish on top of everything */
    }

    .fish {
      position: absolute;
      width: 115px;
      height: 65px;
      background-image: url("guppy1.PNG");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transform-origin: center center;
      filter: drop-shadow(0 6px 8px rgba(0,0,0,0.6));
      cursor: pointer;
    }

    /* --- UI Bubbles --- */
    .bubbleBtn {
      position: fixed;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #cfeeff, #60c7ff);
      border: 2px solid rgba(255,255,255,0.75);
      box-shadow: 0 0 11px rgba(0,150,255,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      user-select: none;
      z-index: 10;
    }

    #feedBtn  { left: 12px; top: 25%; }
    #cleanBtn { left: 12px; top: 45%; }
    #buyBtn   { right: 12px; top: 25%; }
    #shopBtn  { right: 12px; top: 45%; }

    #coinBubble {
      position: fixed;
      top: 16px;
      right: 18px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: radial-gradient(circle, #fff7bf, #ffcc33);
      border: 2px solid rgba(255,255,255,0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #5a3900;
      font-size: 11px;
      z-index: 11;
      box-shadow: 0 0 13px rgba(255,210,90,0.9);
    }

    #coinBubble span {
      font-size: 15px;
      margin-top: 3px;
    }

    /* --- Fish info --- */
    #fishInfoPanel {
      position: fixed;
      left: 50%;
      top: 10%;
      transform: translateX(-50%);
      padding: 10px 14px;
      background: rgba(0,0,0,0.86);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.45);
      min-width: 190px;
      max-width: 260px;
      font-size: 13px;
      display: none;
      z-index: 20;
      backdrop-filter: blur(8px);
    }

    #fishInfoTitle {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
      text-align: center;
    }

    #fishInfoBody {
      white-space: pre-line;
      opacity: 0.95;
      line-height: 1.4;
      font-size: 12px;
    }

    #fishInfoHint {
      margin-top: 6px;
      font-size: 11px;
      opacity: 0.7;
      text-align: center;
    }

    audio { display: none; }
  </style>
</head>
<body>

<div id="gameRoot">
  <div id="tank">
    <div id="tankBackground"></div>
    <canvas id="fxCanvas"></canvas>
    <div id="fishLayer"></div>
  </div>

  <!-- UI -->
  <div id="coinBubble">ü™ô<span id="coinCount">80</span></div>
  <div id="feedBtn"  class="bubbleBtn">üç§</div>
  <div id="cleanBtn" class="bubbleBtn">üßΩ</div>
  <div id="buyBtn"   class="bubbleBtn">üê†</div>
  <div id="shopBtn"  class="bubbleBtn">üõí</div>

  <!-- Fish info -->
  <div id="fishInfoPanel">
    <div id="fishInfoTitle">Guppy</div>
    <div id="fishInfoBody"></div>
    <div id="fishInfoHint">Tap this panel to rename</div>
  </div>
</div>

<audio id="bgMusic" src="bg-music.mp3" loop></audio>

<script>
/* ===== Helpers ===== */
const rand = (a, b) => a + Math.random() * (b - a);
const choice = arr => arr[Math.floor(Math.random() * arr.length)];

const tank      = document.getElementById("tank");
const tankBg    = document.getElementById("tankBackground");
const fishLayer = document.getElementById("fishLayer");
const fxCanvas  = document.getElementById("fxCanvas");
const ctx       = fxCanvas.getContext("2d");
let tankRect    = tank.getBoundingClientRect();

function updateTankRect() {
  tankRect = tank.getBoundingClientRect();
  fxCanvas.width  = tankRect.width;
  fxCanvas.height = tankRect.height;
}
updateTankRect();
window.addEventListener("resize", updateTankRect);

/* ===== Coins ===== */
let coins = 80;
const coinCountEl = document.getElementById("coinCount");
coinCountEl.textContent = coins;

/* ===== Fish Info Panel ===== */
const fishInfoPanel = document.getElementById("fishInfoPanel");
const fishInfoTitle = document.getElementById("fishInfoTitle");
const fishInfoBody  = document.getElementById("fishInfoBody");

function formatAge(sec) {
  if (sec < 60) return `${Math.floor(sec)} sec`;
  const m = Math.floor(sec / 60);
  if (m < 60) return `${m} min`;
  const h = Math.floor(m / 60);
  return `${h} hr`;
}

function showFishInfo(f) {
  fishInfoPanel.dataset.fishId = String(f.id);
  fishInfoTitle.textContent = `${f.species} (${f.gender})`;
  fishInfoBody.textContent =
    `Name: ${f.name}\n` +
    `Health: ${f.health}\n` +
    `Age: ${formatAge(f.ageSeconds)}\n` +
    `Temperament: ${f.temperament}`;
  fishInfoPanel.style.display = "block";
}

function hideFishInfo() {
  fishInfoPanel.style.display = "none";
}

fishInfoPanel.addEventListener("click", e => {
  e.stopPropagation();
  const id = Number(fishInfoPanel.dataset.fishId || 0);
  const f = fishList.find(x => x.id === id);
  if (!f) return;
  const newName = prompt("Enter a new name:", f.name);
  if (!newName) return;
  f.name = newName.trim() || f.name;
  showFishInfo(f);
});

document.getElementById("gameRoot").addEventListener("click", e => {
  if (e.target.classList.contains("fish")) return;
  hideFishInfo();
});

/* ===== Fish Data & Creation ===== */
const fishList = [];
let nextFishId = 1;
const TEMPERAMENTS = ["Calm", "Normal", "Active"];

function createGuppy() {
  if (coins < 20) return;
  coins -= 20;
  coinCountEl.textContent = coins;

  const w = tankRect.width;
  const h = tankRect.height;

  const gender      = Math.random() < 0.6 ? "Female" : "Male";
  const temperament = choice(TEMPERAMENTS);
  const species     = "Guppy";
  const name        = `${species} #${nextFishId}`;

  let baseSpeed;
  if      (temperament === "Calm")   baseSpeed = rand(22, 28);
  else if (temperament === "Active") baseSpeed = rand(32, 40);
  else                               baseSpeed = rand(26, 34);

  const f = {
    id: nextFishId++,
    species,
    name,
    gender,
    temperament,
    health: "Good",
    ageSeconds: 0,

    // start more in mid-water so tank feels open
    x: rand(w * 0.15, w * 0.85),
    y: rand(h * 0.20, h * 0.55),
    direction: Math.random() < 0.5 ? -1 : 1,

    baseSpeed,
    targetX: rand(w * 0.15, w * 0.85),
    targetY: rand(h * 0.20, h * 0.55),
    changeTimer: rand(3, 7),

    wigglePhase: Math.random() * Math.PI * 2,
    wiggleSpeed: rand(4, 6),
    wiggleAmount: 3,
    el: null
  };

  const el = document.createElement("div");
  el.className = "fish";
  f.el = el;

  // tap detection (mobile + pc)
  let downX = 0, downY = 0, downTime = 0;
  el.addEventListener("pointerdown", e => {
    downX = e.clientX;
    downY = e.clientY;
    downTime = performance.now();
  });
  el.addEventListener("pointerup", e => {
    const dx = Math.abs(e.clientX - downX);
    const dy = Math.abs(e.clientY - downY);
    const dt = performance.now() - downTime;
    if (dx < 10 && dy < 10 && dt < 250) {
      e.stopPropagation();
      showFishInfo(f);
    }
  });

  fishLayer.appendChild(el);
  fishList.push(f);
}

/* ===== Fish Movement ===== */
function updateFish(dt) {
  const w = tankRect.width;
  const h = tankRect.height;

  const marginX     = w * 0.06;
  const topLimit    = h * 0.15;  // can go slightly higher
  const bottomLimit = h * 0.60;  // avoid very bottom so view feels open

  for (const f of fishList) {
    f.ageSeconds += dt;

    f.changeTimer -= dt;
    if (f.changeTimer <= 0) {
      f.targetX = rand(w * 0.15, w * 0.85);
      f.targetY = rand(h * 0.20, h * 0.55);
      const baseMin = f.temperament === "Active" ? 2.5 : 4;
      const baseMax = f.temperament === "Active" ? 5   : 7;
      f.changeTimer = rand(baseMin, baseMax);
    }

    const dx = f.targetX - f.x;
    const dy = f.targetY - f.y;

    const speed    = f.baseSpeed;
    const maxStepX = speed * dt;
    const maxStepY = speed * 0.35 * dt;

    if (Math.abs(dx) <= maxStepX) f.x = f.targetX;
    else f.x += Math.sign(dx) * maxStepX;

    if (Math.abs(dy) <= maxStepY) f.y = f.targetY;
    else f.y += Math.sign(dy) * maxStepY;

    if (dx > 2)      f.direction = 1;
    else if (dx < -2) f.direction = -1;

    if (f.x < marginX) {
      f.x = marginX;
      f.targetX   = rand(marginX + 30, w - marginX);
      f.direction = 1;
    } else if (f.x > w - marginX) {
      f.x = w - marginX;
      f.targetX   = rand(marginX, w - marginX - 30);
      f.direction = -1;
    }

    if (f.y < topLimit)    f.y = topLimit;
    if (f.y > bottomLimit) f.y = bottomLimit;

    f.wigglePhase += f.wiggleSpeed * dt;
    const wiggleTilt = Math.sin(f.wigglePhase) * f.wiggleAmount;
    const swimTilt   = Math.max(-10, Math.min(10, -dy * 0.15));
    const tilt       = wiggleTilt + swimTilt;

    const face = -f.direction; // flip sign if they look backwards

    f.el.style.left = `${f.x - 57.5}px`;
    f.el.style.top  = `${f.y - 32.5}px`;
    f.el.style.transform = `scaleX(${face}) rotate(${tilt}deg)`;
  }
}

/* ===== Background FX: smooth sway + calmer bubbles ===== */
let fxTime = 0;
const bubbles = [];

function spawnBubble() {
  const x = Math.random() * tankRect.width;
  const size = rand(4, 10);
  const speed = rand(20, 45);
  bubbles.push({
    x,
    y: tankRect.height + size + rand(0, 60),
    size,
    speed,
    wobblePhase: Math.random() * Math.PI * 2,
    wobbleSpeed: rand(1.5, 3),
    wobbleAmount: rand(3, 8)
  });
}

// fewer starting bubbles
for (let i = 0; i < 8; i++) spawnBubble();

function updateFx(dt) {
  fxTime += dt;

  // smooth gentle sway for whole background
  const swayY = Math.sin(fxTime * 0.12) * 10;
  const swayX = Math.sin(fxTime * 0.08) * 6;
  tankBg.style.transform = `translate(${swayX}px, ${swayY}px)`;

  ctx.clearRect(0, 0, fxCanvas.width, fxCanvas.height);

  // soft water glow
  const g = ctx.createLinearGradient(0, 0, 0, fxCanvas.height);
  g.addColorStop(0, "rgba(255,255,255,0.10)");
  g.addColorStop(0.35, "rgba(0,0,0,0.03)");
  g.addColorStop(1, "rgba(0,0,0,0.20)");
  ctx.fillStyle = g;
  ctx.fillRect(0, 0, fxCanvas.width, fxCanvas.height);

  // calmer bubble spawn rate
  if (Math.random() < 2 * dt) spawnBubble();

  ctx.save();
  ctx.globalCompositeOperation = "lighter";
  for (let i = bubbles.length - 1; i >= 0; i--) {
    const b = bubbles[i];
    b.y -= b.speed * dt;
    b.wobblePhase += b.wobbleSpeed * dt;
    const wobbleX = Math.sin(b.wobblePhase) * b.wobbleAmount;

    if (b.y < -b.size - 20) {
      bubbles.splice(i, 1);
      continue;
    }

    ctx.beginPath();
    ctx.arc(b.x + wobbleX, b.y, b.size, 0, Math.PI * 2);
    ctx.strokeStyle = "rgba(255,255,255,0.75)";
    ctx.lineWidth = 1;
    ctx.stroke();

    const gb = ctx.createRadialGradient(
      b.x + wobbleX - b.size * 0.4,
      b.y - b.size * 0.4,
      0,
      b.x + wobbleX,
      b.y,
      b.size
    );
    gb.addColorStop(0, "rgba(255,255,255,0.45)");
    gb.addColorStop(1, "rgba(255,255,255,0.05)");
    ctx.fillStyle = gb;
    ctx.fill();
  }
  ctx.restore();
}

/* ===== Main Loop ===== */
let lastTime = null;
function frame(ts) {
  if (lastTime == null) lastTime = ts;
  let dt = (ts - lastTime) / 1000;
  lastTime = ts;
  if (dt > 0.05) dt = 0.05;

  updateTankRect();
  updateFish(dt);
  updateFx(dt);

  requestAnimationFrame(frame);
}

/* ===== Init ===== */
function initGame() {
  updateTankRect();
  createGuppy();
  createGuppy();
  createGuppy();
  requestAnimationFrame(frame);
}
initGame();

/* ===== UI Buttons ===== */
document.getElementById("buyBtn").addEventListener("click", createGuppy);

document.getElementById("feedBtn").addEventListener("click", () => {
  alert("Feeding all fish (placeholder)");
});

document.getElementById("cleanBtn").addEventListener("click", () => {
  alert("Cleaning tank (placeholder)");
});

document.getElementById("shopBtn").addEventListener("click", () => {
  alert("Shop coming soon!");
});

/* ===== Music unlock on first touch (mobile) ===== */
const bgMusic = document.getElementById("bgMusic");
function unlockMusic() {
  bgMusic.play().catch(() => {});
  window.removeEventListener("pointerdown", unlockMusic);
}
window.addEventListener("pointerdown", unlockMusic);
</script>
</body>
</html>
